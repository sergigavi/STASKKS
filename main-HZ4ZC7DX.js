import{a as S}from"./chunk-XT64X6G3.js";import{$ as j,A,B as O,C as a,D as P,H as _,Ja as B,L as N,M as F,Ta as H,a as I,bb as Z,d as y,db as G,e as E,eb as Y,ga as x,gb as q,ha as D,hb as $,ib as J,j as l,ja as W,ka as L,n as c,o as T,pa as V,q as f,qa as z,ra as K,s as m,v as u,w as U,y as v}from"./chunk-OKI62E2N.js";var R="Service workers are disabled or not supported by this browser",h=class{serviceWorker;worker;registration;events;constructor(i,t){if(this.serviceWorker=i,!i)this.worker=this.events=this.registration=new y(r=>r.error(new u(5601,!1)));else{let r=null,e=new E;this.worker=new y(p=>(r!==null&&p.next(r),e.subscribe(w=>p.next(w))));let s=()=>{let{controller:p}=i;p!==null&&(r=p,e.next(r))};i.addEventListener("controllerchange",s),s(),this.registration=this.worker.pipe(m(()=>i.getRegistration().then(p=>{if(!p)throw new u(5601,!1);return p})));let o=new E;this.events=o.asObservable();let d=p=>{let{data:w}=p;w?.type&&o.next(w)};i.addEventListener("message",d),t?.get(D,null,{optional:!0})?.onDestroy(()=>{i.removeEventListener("controllerchange",s),i.removeEventListener("message",d)})}}postMessage(i,t){return new Promise(r=>{this.worker.pipe(f(1)).subscribe(e=>{e.postMessage(I({action:i},t)),r()})})}postMessageWithOperation(i,t,r){let e=this.waitForOperationCompleted(r),s=this.postMessage(i,t);return Promise.all([s,e]).then(([,o])=>o)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(i){let t;return typeof i=="string"?t=r=>r.type===i:t=r=>i.includes(r.type),this.events.pipe(T(t))}nextEventOfType(i){return this.eventsOfType(i).pipe(f(1))}waitForOperationCompleted(i){return new Promise((t,r)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(T(e=>e.nonce===i),f(1),l(e=>{if(e.result!==void 0)return e.result;throw new Error(e.error)})).subscribe({next:t,error:r})})}get isEnabled(){return!!this.serviceWorker}},re=(()=>{class n{sw;messages;notificationClicks;notificationCloses;pushSubscriptionChanges;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new E;constructor(t){if(this.sw=t,!t.isEnabled){this.messages=c,this.notificationClicks=c,this.notificationCloses=c,this.pushSubscriptionChanges=c,this.subscription=c;return}this.messages=this.sw.eventsOfType("PUSH").pipe(l(e=>e.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(l(e=>e.data)),this.notificationCloses=this.sw.eventsOfType("NOTIFICATION_CLOSE").pipe(l(e=>e.data)),this.pushSubscriptionChanges=this.sw.eventsOfType("PUSH_SUBSCRIPTION_CHANGE").pipe(l(e=>e.data)),this.pushManager=this.sw.registration.pipe(l(e=>e.pushManager));let r=this.pushManager.pipe(m(e=>e.getSubscription()));this.subscription=new y(e=>{let s=r.subscribe(e),o=this.subscriptionChanges.subscribe(e);return()=>{s.unsubscribe(),o.unsubscribe()}})}requestSubscription(t){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(R));let r={userVisibleOnly:!0},e=this.decodeBase64(t.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),s=new Uint8Array(new ArrayBuffer(e.length));for(let o=0;o<e.length;o++)s[o]=e.charCodeAt(o);return r.applicationServerKey=s,new Promise((o,d)=>{this.pushManager.pipe(m(g=>g.subscribe(r)),f(1)).subscribe({next:g=>{this.subscriptionChanges.next(g),o(g)},error:d})})}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(R));let t=r=>{if(r===null)throw new u(5602,!1);return r.unsubscribe().then(e=>{if(!e)throw new u(5603,!1);this.subscriptionChanges.next(null)})};return new Promise((r,e)=>{this.subscription.pipe(f(1),m(t)).subscribe({next:r,error:e})})}decodeBase64(t){return atob(t)}static \u0275fac=function(r){return new(r||n)(O(h))};static \u0275prov=v({token:n,factory:n.\u0275fac})}return n})(),k=(()=>{class n{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}ongoingCheckForUpdate=null;constructor(t){if(this.sw=t,!t.isEnabled){this.versionUpdates=c,this.unrecoverable=c;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(R));if(this.ongoingCheckForUpdate)return this.ongoingCheckForUpdate;let t=this.sw.generateNonce();return this.ongoingCheckForUpdate=this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:t},t).finally(()=>{this.ongoingCheckForUpdate=null}),this.ongoingCheckForUpdate}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new u(5601,!1));let t=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:t},t)}static \u0275fac=function(r){return new(r||n)(O(h))};static \u0275prov=v({token:n,factory:n.\u0275fac})}return n})(),ee=new A("");function oe(){let n=a(b);if(!("serviceWorker"in navigator&&n.enabled!==!1))return;let i=a(ee),t=a(N),r=a(D);t.runOutsideAngular(()=>{let e=navigator.serviceWorker,s=()=>e.controller?.postMessage({action:"INITIALIZE"});e.addEventListener("controllerchange",s),r.onDestroy(()=>{e.removeEventListener("controllerchange",s)})}),t.runOutsideAngular(()=>{let e,{registrationStrategy:s}=n;if(typeof s=="function")e=new Promise(o=>s().subscribe(()=>o()));else{let[o,...d]=(s||"registerWhenStable:30000").split(":");switch(o){case"registerImmediately":e=Promise.resolve();break;case"registerWithDelay":e=Q(+d[0]||0);break;case"registerWhenStable":e=Promise.race([r.whenStable(),Q(+d[0])]);break;default:throw new u(5600,!1)}}e.then(()=>{r.destroyed||navigator.serviceWorker.register(i,{scope:n.scope,updateViaCache:n.updateViaCache,type:n.type}).catch(o=>console.error(U(5604,!1)))})})}function Q(n){return new Promise(i=>setTimeout(i,n))}function se(){let n=a(b),i=a(_),t=!0;return new h(t&&n.enabled!==!1?navigator.serviceWorker:void 0,i)}var b=class{enabled;updateViaCache;type;scope;registrationStrategy};function te(n,i={}){return P([re,k,{provide:ee,useValue:n},{provide:b,useValue:i},{provide:h,useFactory:se},x(oe)])}var C=class n{swUpdate=a(k);constructor(){this.swUpdate.isEnabled&&this.checkForUpdates()}checkForUpdates(){this.swUpdate.versionUpdates.subscribe(i=>{i.type==="VERSION_READY"&&this.promptUpdate()})}promptUpdate(){confirm("New version available! Would you like to update now?")&&this.swUpdate.activateUpdate().then(()=>{document.location.reload()})}async checkUpdate(){return this.swUpdate.isEnabled?await this.swUpdate.checkForUpdate():!1}static \u0275fac=function(t){return new(t||n)};static \u0275prov=v({token:n,factory:n.\u0275fac,providedIn:"root"})};var ne=[{path:"",loadComponent:()=>import("./chunk-QUFMI4YI.js").then(n=>n.HomeComponent)},{path:"settings",loadComponent:()=>import("./chunk-EAMY7VYD.js").then(n=>n.SettingsComponent)},{path:"**",redirectTo:""}];var ie={providers:[q(ne),H(),$,S,C,te("/STASKKS/ngsw-worker.js",{enabled:!0})]};function ae(n,i){n&1&&(V(0,"div",0),B(1,"Loading..."),z())}function pe(n,i){n&1&&K(0,"router-outlet")}var M=class n{title="STASKK";appStore=a(J);themeService=a(S);initialized=F(!1);async ngOnInit(){try{this.themeService.initialize(),await this.appStore.initialize(),this.initialized.set(!0)}catch(i){console.error("App initialization failed:",i),this.initialized.set(!0)}}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=j({type:n,selectors:[["app-root"]],decls:2,vars:1,consts:[[1,"loading"]],template:function(t,r){t&1&&W(0,ae,2,0,"div",0)(1,pe,1,0,"router-outlet"),t&2&&L(r.initialized()?1:0)},dependencies:[Z,Y],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif}.loading[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:100vh;font-size:1.125rem;color:var(--text-secondary)}"]})};G(M,ie).catch(n=>console.error(n));
