import{B as m,C as S,M as D,a as d,b as g,ca as j,hb as h,ib as I,y as f}from"./chunk-OKI62E2N.js";var b=class c{translationService=S(h);transform(e,t){return this.translationService.translate(e,t)}static \u0275fac=function(t){return new(t||c)};static \u0275pipe=j({name:"translate",type:c,pure:!1})};var v=class c{notifications=D([]);notifications$=this.notifications.asReadonly();DEFAULT_DURATION=3e3;success(e,t){this.add(d({type:"success",message:e,duration:this.DEFAULT_DURATION},t))}error(e,t){this.add(d({type:"error",message:e,duration:5e3},t))}warning(e,t){this.add(d({type:"warning",message:e,duration:4e3},t))}info(e,t){this.add(d({type:"info",message:e,duration:this.DEFAULT_DURATION},t))}confirm(e){return Promise.resolve(window.confirm(e))}prompt(e,t){return Promise.resolve(window.prompt(e,t??""))}add(e){let t=crypto.randomUUID(),r=d({id:t},e);if(this.notifications.update(a=>[...a,r]),r.duration!==0){let a=r.duration??this.DEFAULT_DURATION;setTimeout(()=>{this.dismiss(t)},a)}}dismiss(e){this.notifications.update(t=>t.filter(r=>r.id!==e))}clear(){this.notifications.set([])}static \u0275fac=function(t){return new(t||c)};static \u0275prov=f({token:c,factory:c.\u0275fac,providedIn:"root"})};var T=class c{VALID_STATUSES=["BACKLOG","PAUSED","IN_PROGRESS","DONE"];VALID_PRIORITIES=["LOW","MEDIUM","HIGH"];validateImportData(e){if(!e||typeof e!="object")return{valid:!1,errors:["Data must be an object"]};let t=e;if(!Array.isArray(t.projects))return{valid:!1,errors:["projects must be an array"]};if(!Array.isArray(t.tasks))return{valid:!1,errors:["tasks must be an array"]};if(t.projects.length>100)return{valid:!1,errors:["Cannot import more than 100 projects"]};if(t.tasks.length>1e4)return{valid:!1,errors:["Cannot import more than 10,000 tasks"]};let r=this.validateProjects(t.projects),a=this.validateTasks(t.tasks);return r.length>0||a.length>0?{valid:!1,errors:[...r,...a]}:{valid:!0,errors:[],data:{projects:t.projects,tasks:t.tasks}}}validateProjects(e){let t=[];return e.forEach((r,a)=>{if(!r||typeof r!="object"){t.push(`Project at index ${a} is not an object`);return}let i=r;(!i.id||typeof i.id!="string"||!i.id.toString().trim())&&t.push(`Project at index ${a} missing or invalid id`),(!i.name||typeof i.name!="string"||i.name.toString().trim().length===0)&&t.push(`Project at index ${a} missing or invalid name`),i.name&&typeof i.name=="string"&&i.name.length>200&&t.push(`Project at index ${a} name exceeds maximum length (200 chars)`),(!i.createdAt||typeof i.createdAt!="number"||i.createdAt<=0)&&t.push(`Project at index ${a} missing or invalid createdAt`),(!i.updatedAt||typeof i.updatedAt!="number"||i.updatedAt<=0)&&t.push(`Project at index ${a} missing or invalid updatedAt`)}),t}validateTasks(e){let t=[];return e.forEach((r,a)=>{if(!r||typeof r!="object"){t.push(`Task at index ${a} is not an object`);return}let i=r;(!i.id||typeof i.id!="string"||!i.id.toString().trim())&&t.push(`Task at index ${a} missing or invalid id`),(!i.projectId||typeof i.projectId!="string"||!i.projectId.toString().trim())&&t.push(`Task at index ${a} missing or invalid projectId`),(!i.title||typeof i.title!="string"||i.title.toString().trim().length===0)&&t.push(`Task at index ${a} missing or invalid title`),i.title&&typeof i.title=="string"&&i.title.length>500&&t.push(`Task at index ${a} title exceeds maximum length (500 chars)`);let s=i.status;(!s||!this.VALID_STATUSES.includes(s))&&t.push(`Task at index ${a} missing or invalid status`),(!i.order||typeof i.order!="number"||i.order<0)&&t.push(`Task at index ${a} missing or invalid order`),"description"in i&&i.description!==void 0&&(typeof i.description!="string"?t.push(`Task at index ${a} invalid description type`):i.description.length>5e3&&t.push(`Task at index ${a} description exceeds maximum length (5000 chars)`));let o=i.priority;if("priority"in i&&o!==void 0&&!this.VALID_PRIORITIES.includes(o)&&t.push(`Task at index ${a} invalid priority`),"tags"in i&&i.tags!==void 0){let l=i.tags;Array.isArray(l)?l.length>20?t.push(`Task at index ${a} exceeds maximum tags (20)`):l.forEach((n,p)=>{typeof n!="string"?t.push(`Task at index ${a}, tag ${p} is not a string`):n.length>50&&t.push(`Task at index ${a}, tag ${p} exceeds maximum length (50 chars)`)}):t.push(`Task at index ${a} tags must be an array`)}"dueDate"in i&&i.dueDate!==void 0&&(typeof i.dueDate!="number"||i.dueDate<=0)&&t.push(`Task at index ${a} invalid dueDate`),(!i.createdAt||typeof i.createdAt!="number"||i.createdAt<=0)&&t.push(`Task at index ${a} missing or invalid createdAt`),(!i.updatedAt||typeof i.updatedAt!="number"||i.updatedAt<=0)&&t.push(`Task at index ${a} missing or invalid updatedAt`)}),t}validateSingleTaskData(e,t){if(!e||typeof e!="object")return{valid:!1,errors:["Task data must be an object"]};let r=e;if(!r.Title||typeof r.Title!="string"||r.Title.toString().trim().length===0)return{valid:!1,errors:["Title is required"]};if(r.Title&&typeof r.Title=="string"&&r.Title.length>500)return{valid:!1,errors:["Title exceeds maximum length (500 chars)"]};let a=r.Column,i=r.Priority;if(!a)return{valid:!1,errors:["Column is required"]};if("Description"in r&&r.Description!==void 0){if(typeof r.Description!="string")return{valid:!1,errors:["Description must be a string"]};if(r.Description.length>5e3)return{valid:!1,errors:["Description exceeds maximum length (5000 chars)"]}}if("Tags"in r&&r.Tags!==void 0){let n=r.Tags;if(Array.isArray(n)){if(n.length>20)return{valid:!1,errors:["Cannot have more than 20 tags"]};{let p=!1;for(let u=0;u<n.length;u++){let y=n[u];if(typeof y!="string")return{valid:!1,errors:[`Tag at index ${u} is not a string`]};if(y.length>50)return{valid:!1,errors:[`Tag at index ${u} exceeds maximum length (50 chars)`]}}}}else return{valid:!1,errors:["Tags must be an array"]}}let s={Backlog:"BACKLOG",Paused:"PAUSED","In Progress":"IN_PROGRESS",Done:"DONE",BACKLOG:"BACKLOG",PAUSED:"PAUSED",IN_PROGRESS:"IN_PROGRESS",DONE:"DONE"},o={None:void 0,Low:"LOW",Medium:"MEDIUM",High:"HIGH",LOW:"LOW",MEDIUM:"MEDIUM",HIGH:"HIGH"};if(!s[a])return{valid:!1,errors:["Column must be one of: Backlog, Paused, In Progress, Done"]};if(i&&i!=="None"&&!(i in o))return{valid:!1,errors:["Priority must be one of: None, Low, Medium, High"]};let l;if(r.Due_Date&&typeof r.Due_Date=="string"){let n=new Date(r.Due_Date);if(isNaN(n.getTime()))return{valid:!1,errors:["Invalid due date format"]};l=n.getTime()}return{valid:!0,errors:[],task:{projectId:t,title:r.Title,description:r.Description,status:s[a],priority:o[r.Priority]||void 0,tags:r.Tags,dueDate:l},status:s[a]}}static \u0275fac=function(t){return new(t||c)};static \u0275prov=f({token:c,factory:c.\u0275fac,providedIn:"root"})};var P=class c{constructor(e,t,r,a){this.appStore=e;this.notification=t;this.validator=r;this.translation=a}async exportData(){try{let t=await this.appStore.storage.exportData(),r=JSON.stringify(t,null,2),a=new Blob([r],{type:"application/json"}),i=URL.createObjectURL(a),s=document.createElement("a");s.href=i;let o=new Date().toISOString().split("T")[0];s.download=`yira-backup-${o}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i),this.notification.success("settings.exportSuccess")}catch(e){throw console.error("Export failed:",e),this.notification.error("validation.exportFailed"),e}}async importData(e){try{let t=await e.text(),r=JSON.parse(t),a=this.validator.validateImportData(r);if(!a.valid){let o=a.errors.join(`
`);this.notification.error("validation.importFailed",{details:o});return}if(!await this.notification.confirm("settings.importConfirm"))return;await this.appStore.storage.importData(a.data),await this.appStore.initialize(),this.notification.success("settings.importSuccess")}catch(t){throw t instanceof SyntaxError?this.notification.error("validation.invalidJson"):(console.error("Import failed:",t),this.notification.error("validation.importFailed")),t}}async clearAllData(){if(!await this.notification.confirm("settings.clearConfirm"))return;let t=await this.notification.prompt("settings.clearDoubleConfirm");if(!(t!=="BORRAR"&&t!=="DELETE"))try{await this.appStore.clearAllData(),this.notification.success("settings.clearSuccess")}catch(r){throw console.error("Clear data failed:",r),this.notification.error("validation.clearFailed"),r}}async validateSingleTaskFile(e){try{let t=await e.text(),r=JSON.parse(t),a=this.appStore.activeProjectId();return a?Array.isArray(r)?this.validateMultipleTasks(r,a):this.validator.validateSingleTaskData(r,a):{valid:!1,errors:["No active project"]}}catch(t){return t instanceof SyntaxError?{valid:!1,errors:["Invalid JSON format"]}:{valid:!1,errors:["Failed to parse file"]}}}async importSingleTask(e,t){try{let r=await e.text(),a=JSON.parse(r),i=this.appStore.activeProjectId();if(!i){this.notification.error("validation.importFailed");return}if(Array.isArray(a)){await this.importMultipleTasks(a,i,t);return}let s=this.validator.validateSingleTaskData(a,i);if(!s.valid){let o=s.errors.join(`
`);this.notification.error("validation.invalidTaskFormat");return}s.task&&(await this.appStore.createTask(g(d({},s.task),{status:t})),this.notification.success("task.importSuccess"))}catch(r){throw r instanceof SyntaxError?this.notification.error("validation.invalidJson"):(console.error("Import single task failed:",r),this.notification.error("validation.importFailed")),r}}validateMultipleTasks(e,t){let r=[],a=[];for(let i=0;i<e.length;i++){let s=e[i],o=this.validator.validateSingleTaskData(s,t);o.valid&&o.task?r.push(g(d({},o.task),{status:"BACKLOG"})):a.push(`Task ${i+1}: ${o.errors.join(", ")}`)}return a.length>0?{valid:!1,errors:a}:{valid:!0,errors:[],task:void 0,status:"BACKLOG"}}async importMultipleTasks(e,t,r){for(let i of e)await this.appStore.createTask(g(d({},i),{status:r||"BACKLOG"}));let a=this.translation.translate("task.importMultipleSuccess",{count:e.length});this.notification.success(a)}async exportTask(e){try{let t=this.appStore.tasks().find(p=>p.id===e);if(!t){this.notification.error("validation.taskNotFound");return}let a=this.appStore.projects().find(p=>p.id===t.projectId)?.name||"Unknown",i=this.formatTaskForExport(t,a),s=JSON.stringify(i,null,2),o=new Blob([s],{type:"application/json"}),l=URL.createObjectURL(o),n=document.createElement("a");n.href=l,n.download=`task-${t.title.replace(/[^a-z0-9]/gi,"-").toLowerCase()}-${Date.now()}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l),this.notification.success("task.exportSuccess")}catch(t){throw console.error("Export task failed:",t),this.notification.error("validation.taskExportFailed"),t}}async copyTaskToClipboard(e){try{let t=this.appStore.tasks().find(o=>o.id===e);if(!t){this.notification.error("validation.taskNotFound");return}let a=this.appStore.projects().find(o=>o.id===t.projectId)?.name||"Unknown",i=this.formatTaskForExport(t,a),s=JSON.stringify(i,null,2);navigator.clipboard&&navigator.clipboard.writeText?(await navigator.clipboard.writeText(s),this.notification.success("task.copySuccess")):this.notification.error("validation.clipboardNotSupported")}catch(t){throw console.error("Copy task failed:",t),this.notification.error("validation.copyFailed"),t}}formatTaskForExport(e,t){let r={BACKLOG:"Backlog",PAUSED:"Paused",IN_PROGRESS:"In Progress",DONE:"Done"},a={LOW:"Low",MEDIUM:"Medium",HIGH:"High"};return{Project:t,Column:r[e.status],Export_Date:new Date().toISOString().replace("T"," ").replace(/\.\d{3}Z$/,""),Title:e.title,Description:e.description||void 0,Priority:e.priority?a[e.priority]:"None",Tags:e.tags||void 0,Due_Date:e.dueDate?new Date(e.dueDate).toISOString().replace("T"," ").replace(/\.\d{3}Z$/,""):void 0}}static \u0275fac=function(t){return new(t||c)(m(I),m(v),m(T),m(h))};static \u0275prov=f({token:c,factory:c.\u0275fac,providedIn:"root"})};export{b as a,v as b,P as c};
